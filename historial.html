<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard de Vuelos atendidos</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family: 'Roboto', sans-serif;
    background: #eef2f7;
    color: #333;
    padding: 20px;
    transition: background 0.3s, color 0.3s;
  }

  h1 {
    text-align:center;
    color: #0f254d;
    margin-bottom: 10px;
    font-weight: 700;
    letter-spacing: 1px;
  }

  .top-bar {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:15px;
    flex-wrap: wrap;
  }

  .top-bar .contadores {
    text-align:right;
    font-weight:500;
    color:#0f254d;
  }

  .top-bar .contadores span {
    display:block;
    font-size:14px;
    margin-bottom:3px;
  }

  .mode-btn {
    padding:10px 20px;
    background:#0f254d;
    color:#eaf2ff;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-size:16px;
    font-weight:600;
    margin-bottom:10px;
    transition: background 0.3s, color 0.3s;
  }

  .table-container {
    max-width:1200px;
    margin:0 auto;
    background:#fff;
    border-radius:12px;
    box-shadow:0 6px 20px rgba(0,0,0,0.12);
    overflow:hidden;
    transition: background 0.3s;
  }

  .filter-container {
    padding:15px 20px;
    background:#0f254d;
    transition: background 0.3s;
  }

  .filter-container input {
    width:100%;
    padding:12px 14px;
    border-radius:8px;
    border:none;
    outline:none;
    font-size:16px;
    font-weight:500;
  }

  .table-scroll {
    max-height:500px;
    overflow-y:auto;
  }

  table {
    width:100%;
    border-collapse:collapse;
    font-weight:500;
    transition: color 0.3s, background 0.3s;
  }

  thead {
    position:sticky;
    top:0;
    z-index:2;
    cursor:pointer;
    transition: background 0.3s, color 0.3s;
  }

  th, td {
    padding:14px 12px;
    text-align:center;
    border-bottom:1px solid #ddd;
    transition: background 0.3s, color 0.3s;
    font-size:15px;
  }

  th { background-color:#0f254d; color:#eaf2ff; font-weight:700; letter-spacing:0.5px; }
  tr:nth-child(even) { background-color:#f2f5f9; }
  tbody tr:hover { background-color:#cde0f7; }
  .loading { text-align:center; font-style:italic; color:#666; }

  td:nth-child(1) { color:#1a237e; font-weight:500; }
  td:nth-child(2) { color:#00695c; }
  td:nth-child(3) { color:#b71c1c; }
  td:nth-child(4) { color:#f57f17; }
  td:nth-child(5) { color:#4a148c; }

  body.night {
    background:#0a1e3c;
    color:#e0eafc;
  }

  body.night h1 { color:#cfdfff; }
  body.night .table-container { background:#0e1b36; }
  body.night .filter-container { background:#13244d; }
  body.night .mode-btn { background:#1f3570; color:#eaf2ff; }
  body.night thead { background-color:#1a2c59; color:#cfdfff; }
  body.night tr:nth-child(even) { background-color:#11203b; }
  body.night tbody tr:hover { background-color:#1e3a70; }
  body.night td:nth-child(1) { color:#a5c3ff; }
  body.night td:nth-child(2) { color:#66ffcc; }
  body.night td:nth-child(3) { color:#ff8a80; }
  body.night td:nth-child(4) { color:#ffe57f; }
  body.night td:nth-child(5) { color:#d1a3ff; }
  body.night .loading { color:#aaa; }

  body.night .top-bar .contadores { color:#cfdfff; }
  body.night .top-bar .contadores span { color:#cfdfff; }

  th.asc::after { content:" ▲"; }
  th.desc::after { content:" ▼"; }

  @media(max-width:768px){
    th, td { font-size:13px; padding:10px 6px; }
    .filter-container input { font-size:14px; }
    .top-bar { flex-direction:column; align-items:flex-start; }
    .top-bar .contadores { text-align:left; margin-top:10px; }
  }
</style>
</head>
<body>

<div class="top-bar">
  <button class="mode-btn" id="toggleMode">Modo Noche</button>
  <div class="contadores" id="contadores">
    <span>Vuelos hoy: 0</span>
    <span>Vuelos este mes: 0</span>
    <span>Vuelos este año: 0</span>
  </div>
</div>

<div class="table-container">
  <div class="filter-container">
    <input type="text" id="busqueda" placeholder="Filtrar por cualquier columna...">
  </div>
  <div class="table-scroll">
    <table id="tablaVuelos">
      <thead>
        <tr>
          <th data-column="Fecha">Fecha</th>
          <th data-column="Escala">Escala</th>
          <th data-column="Matricula">Matricula</th>
          <th data-column="LLegada Numero Vuelo">LLegada Numero Vuelo</th>
          <th data-column="Salida Numero Vuelo">Salida Numero Vuelo</th>
        </tr>
      </thead>
      <tbody>
        <tr><td colspan="5" class="loading">Cargando datos...</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
const url = "https://script.google.com/macros/s/AKfycbzHBAOf8dQrIiWr0cfk_0cD3WOJ92iHlP7xW59WmkKcjB0zYfL_oiB8wD6gcXgokJ0O/exec";
const tbody = document.querySelector("#tablaVuelos tbody");
const inputFiltro = document.getElementById("busqueda");
const toggleBtn = document.getElementById("toggleMode");
const bodyEl = document.body;
const contadoresEl = document.getElementById("contadores");

let tablaData = [];

function formatFecha(fechaStr){
  if(!fechaStr) return "";
  const date = new Date(fechaStr);
  if(isNaN(date)) return fechaStr;
  const dd = String(date.getDate()).padStart(2,"0");
  const mm = String(date.getMonth()+1).padStart(2,"0");
  const yyyy = date.getFullYear();
  return `${dd}-${mm}-${yyyy}`;
}

function actualizarContadores(){
  const hoy = new Date();
  const dia = hoy.toDateString();
  const mes = hoy.getMonth();
  const anio = hoy.getFullYear();

  const vuelosHoy = tablaData.filter(f=>new Date(f.Fecha).toDateString()===dia).length;
  const vuelosMes = tablaData.filter(f=>new Date(f.Fecha).getMonth()===mes && new Date(f.Fecha).getFullYear()===anio).length;
  const vuelosAnio = tablaData.filter(f=>new Date(f.Fecha).getFullYear()===anio).length;

  contadoresEl.innerHTML = `
    <span>Vuelos hoy: ${vuelosHoy}</span>
    <span>Vuelos este mes: ${vuelosMes}</span>
    <span>Vuelos este año: ${vuelosAnio}</span>
  `;
}

function renderTabla(data){
  tbody.innerHTML="";
  if(!data || data.length===0){
    tbody.innerHTML=`<tr><td colspan="5">No hay datos disponibles</td></tr>`;
    return;
  }
  data.forEach(fila=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${formatFecha(fila["Fecha"])}</td>
      <td>${fila["Escala"]||""}</td>
      <td>${fila["Matricula"]||""}</td>
      <td>${fila["LLegada Numero Vuelo"]||""}</td>
      <td>${fila["Salida Numero Vuelo"]||""}</td>
    `;
    tbody.appendChild(tr);
  });
  actualizarContadores();
}

// Fetch datos
fetch(url)
  .then(res=>res.json())
  .then(data=>{
    tablaData = data;
    renderTabla(tablaData);
  })
  .catch(err=>{
    console.error(err);
    tbody.innerHTML=`<tr><td colspan="5">Error al cargar los datos</td></tr>`;
  });

// Filtro
inputFiltro.addEventListener("input", ()=>{
  const val=inputFiltro.value.toLowerCase();
  const filtrado = tablaData.filter(f=>{
    return Object.values(f).some(v=>String(v).toLowerCase().includes(val));
  });
  renderTabla(filtrado);
});

// Ordenamiento al click
document.querySelectorAll("th").forEach(th=>{
  th.addEventListener("click", ()=>{
    const col = th.getAttribute("data-column");
    const isAsc = th.classList.contains("asc");
    document.querySelectorAll("th").forEach(h=>h.classList.remove("asc","desc"));
    th.classList.toggle(isAsc?"desc":"asc");
    tablaData.sort((a,b)=>{
      let va=a[col]||"", vb=b[col]||"";
      if(col==="Fecha"){ va=new Date(va); vb=new Date(vb);}
      return (va>vb?1:(va<vb?-1:0)) * (isAsc? -1 : 1);
    });
    renderTabla(tablaData);
  });
});

// Modo noche/día
toggleBtn.addEventListener("click", ()=>{
  bodyEl.classList.toggle("night");
  toggleBtn.textContent = bodyEl.classList.contains("night") ? "Modo Día" : "Modo Noche";
});
</script>

</body>
</html>
